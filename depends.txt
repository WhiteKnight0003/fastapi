ğŸ”° Depends() trong Python - Giáº£i thÃ­ch Ä‘Æ¡n giáº£n

ğŸ’¡ Depends() lÃ  gÃ¬ nÃ³i Ä‘Æ¡n giáº£n?
Depends() trong FastAPI giá»‘ng nhÆ° viá»‡c báº¡n nhá» ngÆ°á»i khÃ¡c lÃ m má»™t viá»‡c gÃ¬ Ä‘Ã³ trÆ°á»›c khi báº¡n báº¯t Ä‘áº§u cÃ´ng viá»‡c chÃ­nh cá»§a mÃ¬nh.

ğŸ³ VÃ­ dá»¥ thá»±c táº¿:
Báº¡n lÃ  Ä‘áº§u báº¿p (route handler) cáº§n cÃ³ nguyÃªn liá»‡u (dá»¯ liá»‡u) Ä‘á»ƒ náº¥u Äƒn. Thay vÃ¬ tá»± Ä‘i chá»£, báº¡n nhá» ngÆ°á»i phá»¥ viá»‡c (Depends) Ä‘i láº¥y nguyÃªn liá»‡u giÃºp báº¡n.

ğŸ§‘â€ğŸ³ CÃ¡ch hiá»ƒu qua vÃ­ dá»¥ Ä‘Æ¡n giáº£n:
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# "NgÆ°á»i phá»¥ viá»‡c" Ä‘i láº¥y nÆ°á»›c
def get_drink():
    return "NÆ°á»›c cam"

# "NgÆ°á»i phá»¥ viá»‡c" Ä‘i láº¥y thá»©c Äƒn
def get_food():
    return "BÃ¡nh mÃ¬"

# Báº¡n lÃ  Ä‘áº§u báº¿p - chá»‰ cáº§n táº­p trung náº¥u Äƒn
@app.get("/breakfast")
def make_breakfast(drink: str = Depends(get_drink), food: str = Depends(get_food)):
    return {"Bá»¯a sÃ¡ng cá»§a báº¡n": f"{food} vÃ  {drink}"}
```

ğŸ“Œ Khi ai Ä‘Ã³ truy cáº­p Ä‘Æ°á»ng dáº«n /breakfast:
- FastAPI sáº½ gá»i `get_drink()` láº¥y "NÆ°á»›c cam"
- Rá»“i gá»i `get_food()` láº¥y "BÃ¡nh mÃ¬"
- Sau Ä‘Ã³ má»›i thá»±c hiá»‡n `make_breakfast()` vá»›i dá»¯ liá»‡u Ä‘Ã£ chuáº©n bá»‹ sáºµn

ğŸ“š VÃ­ dá»¥ thá»±c táº¿ dá»… hiá»ƒu:

1ï¸âƒ£ Kiá»ƒm tra ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p chÆ°a:
```python
from fastapi import FastAPI, Depends, HTTPException

app = FastAPI()

def check_login(username: str = None):
    # Giáº£ sá»­ kiá»ƒm tra username tá»« cookie hoáº·c session
    if not username:
        raise HTTPException(status_code=401, detail="Báº¡n chÆ°a Ä‘Äƒng nháº­p")
    return {"username": username}

@app.get("/profile")
def view_profile(user: dict = Depends(check_login)):
    # HÃ m nÃ y chá»‰ cháº¡y khi Ä‘Ã£ Ä‘Äƒng nháº­p thÃ nh cÃ´ng
    return {"message": f"Xin chÃ o {user['username']}"}
```

2ï¸âƒ£ Truy cáº­p database Ä‘Æ¡n giáº£n hÆ¡n:
```python
from fastapi import FastAPI, Depends

app = FastAPI()

def get_db():
    # Giáº£ láº­p káº¿t ná»‘i Ä‘áº¿n database
    print("Má»Ÿ káº¿t ná»‘i Ä‘áº¿n database")
    db = {"users": ["Minh", "Hoa", "Nam"]}
    
    # Tráº£ vá» database cho ngÆ°á»i sá»­ dá»¥ng
    yield db
    
    # Sau khi xong, Ä‘Ã³ng káº¿t ná»‘i
    print("ÄÃ³ng káº¿t ná»‘i database")

@app.get("/users")
def list_users(db = Depends(get_db)):
    # KhÃ´ng cáº§n lo vá» viá»‡c káº¿t ná»‘i/Ä‘Ã³ng database
    return {"users": db["users"]}
```

âœ¨ Lá»£i Ã­ch Ä‘Æ¡n giáº£n cá»§a Depends():
- âœ… Giáº£m láº·p code: Viáº¿t má»™t láº§n, dÃ¹ng nhiá»u nÆ¡i
- âœ… Táº­p trung vÃ o viá»‡c chÃ­nh: Route handler chá»‰ táº­p trung vÃ o logic chÃ­nh
- âœ… Dá»… báº£o trÃ¬: Thay Ä‘á»•i logic phá»¥ trá»£ táº¡i má»™t chá»— duy nháº¥t
- âœ… Sáº¡ch sáº½ hÆ¡n: Code gá»n gÃ ng, dá»… Ä‘á»c hÆ¡n

ğŸ• Khi nÃ o nÃªn dÃ¹ng Depends()?
- ğŸ” Khi báº¡n tháº¥y mÃ¬nh copy-paste code giá»¯a cÃ¡c route handler
- ğŸ—ƒ Khi báº¡n cáº§n truy cáº­p database trong nhiá»u hÃ m
- ğŸ” Khi báº¡n cáº§n xÃ¡c thá»±c ngÆ°á»i dÃ¹ng trÆ°á»›c khi xá»­ lÃ½ yÃªu cáº§u
- ğŸ§© Khi báº¡n muá»‘n tÃ¡ch pháº§n chuáº©n bá»‹ dá»¯ liá»‡u vÃ  xá»­ lÃ½ chÃ­nh

ğŸ¯ Káº¿t luáº­n:
Depends() giÃºp code cá»§a báº¡n trá»Ÿ nÃªn sáº¡ch sáº½, dá»… quáº£n lÃ½ báº±ng cÃ¡ch chia nhá» cÃ´ng viá»‡c thÃ nh cÃ¡c pháº§n nhá» cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng.
