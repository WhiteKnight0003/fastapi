
âœ… JWT lÃ  gÃ¬?
JWT (JSON Web Token) lÃ  chuá»—i mÃ£ hÃ³a chá»©a thÃ´ng tin ngÆ°á»i dÃ¹ng, dÃ¹ng Ä‘á»ƒ xÃ¡c thá»±c vÃ  phÃ¢n quyá»n. Trong FastAPI, JWT giÃºp xÃ¡c minh ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cáº§n lÆ°u phiÃªn (stateless).

ğŸ§© Cáº¥u trÃºc JWT gá»“m 3 pháº§n:
header.payload.signature

- Header: thuáº­t toÃ¡n + loáº¡i token (vÃ­ dá»¥: HS256)
- Payload: thÃ´ng tin ngÆ°á»i dÃ¹ng (ID, quyá»n, háº¡n dÃ¹ng, ...)
- Signature: pháº§n mÃ£ hÃ³a Ä‘á»ƒ báº£o vá»‡ token

ğŸ” CÃ¡ch JWT hoáº¡t Ä‘á»™ng trong FastAPI:
1. NgÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p â†’ server táº¡o JWT vÃ  tráº£ vá»
2. Client lÆ°u JWT vÃ  gá»­i láº¡i token trong má»—i request (qua Authorization: Bearer <token>)
3. FastAPI kiá»ƒm tra token:
   - Giáº£i mÃ£
   - Kiá»ƒm tra chá»¯ kÃ½ (secret key)
   - Kiá»ƒm tra thá»i gian háº¿t háº¡n (exp)
4. Náº¿u há»£p lá»‡ â†’ Cho phÃ©p truy cáº­p


ğŸ” TrÆ°á»ng há»£p sá»­ dá»¥ng thá»±c táº¿: Há»‡ thá»‘ng xÃ¡c thá»±c ngÆ°á»i dÃ¹ng báº±ng JWT trong á»©ng dá»¥ng Web

ğŸ¯ TÃ¬nh huá»‘ng:
XÃ¢y dá»±ng á»©ng dá»¥ng web (FastAPI + React) cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p vÃ  truy cáº­p ná»™i dung cÃ¡ nhÃ¢n nhÆ° trang cÃ¡ nhÃ¢n, cÃ i Ä‘áº·t tÃ i khoáº£n,...

âœ… Quy trÃ¬nh hoáº¡t Ä‘á»™ng:

1. NgÆ°á»i dÃ¹ng gá»­i email + máº­t kháº©u Ä‘áº¿n API /login.
2. Backend kiá»ƒm tra thÃ´ng tin Ä‘Äƒng nháº­p:
   - Náº¿u Ä‘Ãºng â†’ táº¡o JWT chá»©a thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ  thá»i gian háº¿t háº¡n.
   - Tráº£ JWT vá» cho frontend.
3. Frontend lÆ°u JWT vÃ o localStorage hoáº·c cookie.
4. Má»—i request tiáº¿p theo Ä‘áº¿n backend Ä‘á»u gá»­i JWT kÃ¨m theo trong header:
   Authorization: Bearer <jwt_token>
5. Backend kiá»ƒm tra token:
   - Giáº£i mÃ£
   - Kiá»ƒm tra chá»¯ kÃ½ vÃ  thá»i gian háº¿t háº¡n
   - Náº¿u há»£p lá»‡ â†’ cho phÃ©p truy cáº­p API

ğŸ”§ VÃ­ dá»¥ API:

1. /login (POST)
YÃªu cáº§u:
{
  "email": "user@example.com",
  "password": "123456"
}
Pháº£n há»“i:
{
  "access_token": "<JWT_HERE>",
  "token_type": "bearer"
}

2. /profile (GET) - API cáº§n xÃ¡c thá»±c
Header:
Authorization: Bearer <JWT_HERE>
Pháº£n há»“i:
{
  "username": "user1",
  "email": "user@example.com",
  "role": "admin"
}

ğŸ§  Táº¡i sao nÃªn dÃ¹ng JWT?
- Stateless: khÃ´ng cáº§n lÆ°u session server
- Nhanh: xÃ¡c minh báº±ng token, khÃ´ng cáº§n truy váº¥n DB
- Báº£o máº­t (HTTPS + háº¿t háº¡n)
- Dá»… má»Ÿ rá»™ng, phÃ¹ há»£p vá»›i há»‡ thá»‘ng microservices



Khi má»™t cÃ´ng ty cÃ³ 2 á»©ng dá»¥ng khÃ¡c nhau cÃ¹ng sá»­ dá»¥ng chung JWT token, Ä‘iá»u nÃ y mang láº¡i cáº£ lá»£i Ã­ch vÃ  rá»§i ro. DÆ°á»›i Ä‘Ã¢y lÃ  phÃ¢n tÃ­ch ngáº¯n gá»n:

âœ… TÃ¡c dá»¥ng (Lá»£i Ã­ch)
1. Single Sign-On (SSO)
NgÆ°á»i dÃ¹ng chá»‰ cáº§n Ä‘Äƒng nháº­p 1 láº§n, sau Ä‘Ã³ cÃ³ thá»ƒ truy cáº­p cáº£ hai á»©ng dá»¥ng mÃ  khÃ´ng cáº§n Ä‘Äƒng nháº­p láº¡i.

Tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng mÆ°á»£t mÃ , tiá»‡n lá»£i hÆ¡n.

2. Giáº£m táº£i server
KhÃ´ng cáº§n lÆ°u session â†’ giáº£m sá»­ dá»¥ng tÃ i nguyÃªn mÃ¡y chá»§.

CÃ¡c á»©ng dá»¥ng chá»‰ cáº§n giáº£i mÃ£ token Ä‘á»ƒ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng.

3. Dá»… má»Ÿ rá»™ng
Khi triá»ƒn khai thÃªm á»©ng dá»¥ng thá»© 3, chá»‰ cáº§n chia sáº» token chung vÃ  xÃ¡c thá»±c theo cÃ¹ng chuáº©n â†’ khÃ´ng cáº§n viáº¿t láº¡i há»‡ thá»‘ng xÃ¡c thá»±c.

âš ï¸ TÃ¡c háº¡i (Rá»§i ro)
1. TÄƒng rá»§i ro báº£o máº­t
Náº¿u má»™t trong hai á»©ng dá»¥ng bá»‹ táº¥n cÃ´ng hoáº·c lá»™ token, hacker cÃ³ thá»ƒ dÃ¹ng token Ä‘Ã³ Ä‘á»ƒ truy cáº­p má»i á»©ng dá»¥ng khÃ¡c dÃ¹ng chung token â†’ pháº¡m vi táº¥n cÃ´ng má»Ÿ rá»™ng.

2. KhÃ´ng thá»ƒ kiá»ƒm soÃ¡t cá»¥ thá»ƒ theo á»©ng dá»¥ng
Má»™t token khÃ´ng thá»ƒ hiá»‡n rÃµ token nÃ y cáº¥p cho "á»©ng dá»¥ng A" hay "á»©ng dá»¥ng B", gÃ¢y khÃ³ kiá»ƒm soÃ¡t quyá»n theo tá»«ng á»©ng dá»¥ng.

3. Token bá»‹ thu há»“i khÃ³ cáº­p nháº­t
VÃ¬ JWT thÆ°á»ng khÃ´ng lÆ°u tráº¡ng thÃ¡i (stateless), náº¿u báº¡n muá»‘n thu há»“i token khi ngÆ°á»i dÃ¹ng Ä‘Äƒng xuáº¥t á»Ÿ app A, thÃ¬ app B váº«n cÃ³ thá»ƒ dÃ¹ng token Ä‘Ã³ cho Ä‘áº¿n khi háº¿t háº¡n.

ğŸ› ï¸ CÃ¡ch giáº£m thiá»ƒu rá»§i ro
âœ… Gáº¯n thÃªm thÃ´ng tin vÃ o payload nhÆ°: "aud": "app-a" hoáº·c "app": "appA" Ä‘á»ƒ kiá»ƒm tra á»©ng dá»¥ng nÃ o Ä‘ang sá»­ dá»¥ng token.

âœ… Sá»­ dá»¥ng short-lived token (token ngáº¯n háº¡n) + refresh token Ä‘á»ƒ giáº£m thiá»ƒu tÃ¡c Ä‘á»™ng khi token bá»‹ lá»™.

âœ… Ãp dá»¥ng thÃªm cÃ¡c biá»‡n phÃ¡p nhÆ° kiá»ƒm tra IP, thiáº¿t bá»‹, hoáº·c cáº¥p token riÃªng cho tá»«ng app náº¿u cáº§n phÃ¢n tÃ¡ch rÃµ rÃ ng.